<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>School Leave Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />
  <style>
    body { padding: 20px; }
    #calendar { max-width: 900px; margin: 20px auto; }
  </style>
</head>
<body>
<div class="container">
  <h1 class="text-center">School Leave Management System (CY 2025)</h1>

  <!-- Authentication -->
  <div id="auth-section" class="mb-4">
    <div class="form-group">
      <input type="text" id="username" class="form-control" placeholder="Username">
      <input type="password" id="password" class="form-control mt-2" placeholder="Password">
      <button onclick="login()" class="btn btn-primary mt-2">Login</button>
      <button onclick="signup()" class="btn btn-secondary mt-2">Sign Up</button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="d-none">
    <h3>Admin Panel</h3>
    <input type="text" id="new-employee" class="form-control" placeholder="Add Employee">
    <button onclick="addEmployee()" class="btn btn-success mt-2">Add Employee</button>
    <ul id="employee-list" class="list-group mt-3"></ul>
  </div>

  <!-- Leave Request -->
  <div id="leave-section" class="d-none">
    <h3>Request Leave</h3>
    <select id="leave-type" class="form-select">
      <option>Local Credits</option>
      <option>Vacation Leave</option>
      <option>Mandatory/Forced Leave</option>
      <option>Sick Leave</option>
      <option>Maternity Leave</option>
      <option>Paternity Leave</option>
      <option>Special Privilege Leave</option>
      <option>Solo Parent Leave</option>
      <option>Study Leave</option>
      <option>10-Day VAWC Leave</option>
      <option>Rehabilitation Privilege</option>
      <option>Special Leave Benefits for Women</option>
      <option>Special Emergency (Calamity) Leave</option>
      <option>Adoption Leave</option>
    </select>
    <input type="date" id="leave-date" class="form-control mt-2">
    <button onclick="applyLeave()" class="btn btn-warning mt-2">Apply Leave</button>
  </div>

  <!-- Calendar -->
  <div id="calendar" class="mt-4"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
<script>
  let users = JSON.parse(localStorage.getItem('users') || '{}');
  let currentUser = null;
  let events = JSON.parse(localStorage.getItem('events') || '[]');
  let employees = JSON.parse(localStorage.getItem('employees') || '["Juan Dela Cruz", "Maria Santos", "Ana Reyes"]');

  function saveData() {
    localStorage.setItem('users', JSON.stringify(users));
    localStorage.setItem('events', JSON.stringify(events));
    localStorage.setItem('employees', JSON.stringify(employees));
  }

  function login() {
    const uname = document.getElementById('username').value;
    const pass = document.getElementById('password').value;
    if (users[uname] && users[uname].password === pass) {
      currentUser = uname;
      document.getElementById('auth-section').classList.add('d-none');
      document.getElementById('leave-section').classList.remove('d-none');
      if (users[uname].isAdmin) {
        document.getElementById('admin-panel').classList.remove('d-none');
        refreshEmployeeList();
      }
      calendar.refetchEvents();
    } else {
      alert('Invalid login');
    }
  }

  function signup() {
    const uname = document.getElementById('username').value;
    const pass = document.getElementById('password').value;
    if (!users[uname]) {
      users[uname] = { password: pass, isAdmin: false };
      saveData();
      alert('Account created. Please login.');
    } else {
      alert('Username already exists.');
    }
  }

  function addEmployee() {
    const newEmp = document.getElementById('new-employee').value;
    if (newEmp) {
      employees.push(newEmp);
      saveData();
      refreshEmployeeList();
    }
  }

  function deleteEmployee(index) {
    employees.splice(index, 1);
    saveData();
    refreshEmployeeList();
  }

  function refreshEmployeeList() {
    const list = document.getElementById('employee-list');
    list.innerHTML = '';
    employees.forEach((emp, i) => {
      const item = document.createElement('li');
      item.className = 'list-group-item d-flex justify-content-between';
      item.innerHTML = `${emp} <button class='btn btn-danger btn-sm' onclick='deleteEmployee(${i})'>Delete</button>`;
      list.appendChild(item);
    });
  }

  function applyLeave() {
    const date = document.getElementById('leave-date').value;
    const type = document.getElementById('leave-type').value;
    if (date && currentUser) {
      events.push({ title: `${currentUser} - ${type}`, start: date });
      saveData();
      calendar.refetchEvents();
    }
  }

  const calendarEl = document.getElementById('calendar');
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    initialDate: '2025-01-01',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek'
    },
    events: function(fetchInfo, successCallback) {
      successCallback(events);
    }
  });
  calendar.render();
</script>
</body>
</html>
